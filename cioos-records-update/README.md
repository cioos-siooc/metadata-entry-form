# CIOOS Records Update

Section contains all the different compontents used to synchronized the cioos catalogues with the metadata-entry-form.

Both services share the same volume of data where one generates and maintains the different forms and the second provides access to the forms. 

## metadata-entry-forms-web-api
A basic Flask app to create XML from the metadata form

Requires `key.json` which contains a service account key json
specifically one from [here](https://console.cloud.google.com/iam-admin/serviceaccounts/details/108735728189650899572/keys?authuser=0&hl=en&project=cioos-metadata-form) you can also generate one [here](https://console.firebase.google.com/u/0/project/cioos-metadata-form/settings/serviceaccounts/adminsdk).
You can also define the path to this key file by using the environment variable `FIREBASE_KEY_PATH`.

Alternatively the same service account key json string can be specified in the FIREBASE_SERVICE_ACCOUNT_KEY environment variable. The app will look for the environment variable first and fall back to the key.json file if ot found.

## metadata-entry-forms-waf

The metadata-entry-forms-waf service is used to retrieve the metadata forms generated by the metadata entry form. 

## Installation

Clone the repo locally.

Copy the `sample.env` file as `.env` and change the different parameter accordingly if needed.

```
cp sample.env .env
```

Start the containers via docker compose

``` 
docker compose up -d
```

Go to:
- <http://localhost:8092/metadata> to see the WAF server
- <http://localhost:8091/status> to see the api server status.

### Rebuild WAF files

You can rebuild the whole WAF folder by triggering the build command within the container:

```
docker exec metadata-entry-forms-web-api python build.py
```
